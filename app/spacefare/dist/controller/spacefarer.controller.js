sap.ui.define(["./BaseController","sapp/galactic/spacefare/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/Sorter","sap/m/MessageToast"],(e,t,o,s,a,r,i)=>{"use strict";return e.extend("sapp.galactic.spacefare.controller.spacefarer",{formatter:t,onInit(){this.oModel=this.getOwnerComponent().getModel();this.oJsonModel=this.getOwnerComponent().getModel("spacefarerModel");this.fetchUserScope()},fetchUserScope:function(){const e=this.getOwnerComponent().getManifestEntry("/sap.app/id");const t=e.replaceAll(".","/");const o=jQuery.sap.getModulePath(t);$.ajax({url:o+"/user-api/attributes",async:false,success:jQuery.proxy(function(e){const{Groups:t}=e;if(Array.isArray(t)&&t.length&&t.includes("Admin"))this.oJsonModel.setProperty("/isAdmin",true)}).bind(this)})},onSearch:function(){var e=[];const{selectedSuitColor:t,spacefarerName:a,selectedwarmHoleSkill:r,stardustCollection:i}=this.oJsonModel.getData();if(t){e.push(new o("spacesuitColor/ID",s.EQ,t))}if(a){e.push(new o("name",s.Contains,a))}if(i){e.push(new o("stardustCollection",s.GE,i))}if(r){e.push(new o("wormholeNavigationSkill",s.EQ,r))}var n=this.getView().byId("spacefarersTbl");var l=n.getBinding("items");e.length?l.filter(new o(e,true)):l.filter(e)},onSpaceFareresLoaded:function(e){const t=this.getModel("i18n").getResourceBundle().getText("listHeader");this.getView().byId("idListTitle").setText(`${t} (${e.getParameter("total")})`)},onSortButtonPressed:function(){if(!this._oSortDialog){a.load({id:this.getView().getId(),name:"sapp.galactic.spacefare.view.fragments.SortDialog",controller:this}).then(e=>{this._oSortDialog=e;this.getView().addDependent(this._oSortDialog);e.open()})}else{this._oSortDialog.open()}},onGroupButtonPressed:function(){if(!this._oGroupDialog){a.load({id:this.getView().getId(),name:"sapp.galactic.spacefare.view.fragments.GroupDialog",controller:this}).then(e=>{this._oGroupDialog=e;this.getView().addDependent(this._oGroupDialog);e.open()})}else{this._oGroupDialog.open()}},onConfirmSort:function(e){const t=e.getParameter("sortItem");const o=e.getParameter("sortDescending");this.getView().byId("spacefarersTbl").getBinding("items").sort(t?[new r(t.getKey(),o)]:[])},onConfirmGroup:function(e){const t=e.getParameter("groupItem");const o=e.getParameter("groupDescending");this.getView().byId("spacefarersTbl").getBinding("items").sort(t?[new r(t.getKey(),o,true)]:[])},onSpacefarerPress:function(e){this._showObject(e.getSource())},_showObject:function(e){var t=e.getBindingContext();const{ID:o}=t.getModel().oData[t.getPath().replace("/","")];this.getRouter().navTo("details",{spacefarerId:o})},onPressAddNewSpacefarer:function(){if(!this._oCreateDialog){a.load({id:this.getView().getId(),name:"sapp.galactic.spacefare.view.fragments.CreateDialog",controller:this}).then(e=>{this._oCreateDialog=e;this.getView().addDependent(this._oCreateDialog);e.open()})}else{this._oCreateDialog.open()}},onPressCreateNewSpacefarer:function(){const{newName:e,newEmail:t,newPlanet:o,newDepartment:s,newWarmHoleSkill:a,newSpaceSuitColor:r,newStartDuust:n}=this.oJsonModel.getData();let l={name:e,email:t,wormholeNavigationSkill:a,originPlanet_ID:o,department_ID:s,spacesuitColor_ID:r,stardustCollection:n};if(!this._validate(l))return;this.oJsonModel.setProperty("/busy",true);const c=this.getModel("i18n").getResourceBundle();l.position_ID="1c21e3b8-7590-40b0-b450-991d3b3c348f";this.getView().getModel().create("/Spacefarers",l,{success:(e,t)=>{i.show(c.getText("createSuccessMsg"));this.oJsonModel.setProperty("/busy",false);this.onPressCancelNewSpacefarer()},error:e=>{console.log(e);i.show(c.getText("createFailMsg"));this.oJsonModel.setProperty("/busy",false);this.onPressCancelNewSpacefarer()}})},_validate:function(...e){let t=e[0];this.oJsonModel.setProperty("/nameValidState",!!t.name);this.oJsonModel.setProperty("/emailValidState",!!t.email);this.oJsonModel.setProperty("/newWarmHoleSkillState",!!t.wormholeNavigationSkill);this.oJsonModel.setProperty("/planetValueState",!!t.originPlanet_ID);this.oJsonModel.setProperty("/departmentValueState",!!t.department_ID);this.oJsonModel.setProperty("/newSpaceSuitColorState",!!t.spacesuitColor_ID);this.oJsonModel.setProperty("/newStartDuustState",!!t.stardustCollection);return!!t.name&&!!t.email&&!!t.wormholeNavigationSkill&&!!t.originPlanet_ID&&!!t.department_ID&&!!t.spacesuitColor_ID&&!!t.stardustCollection},onPressCancelNewSpacefarer:function(){this._oCreateDialog.close()}})});
//# sourceMappingURL=spacefarer.controller.js.map